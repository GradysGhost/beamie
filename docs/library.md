# Beamie REST API Documentation - Library

## Concepts

Beamie manages a list of directories on disk where media can be located. It
scans the files and determines, where it can, certain metadata about the media.
That data is converted into a database representing the library and a variety
of other data about it, mostly generated by its users. Those locations are
defined in Beamie's config file with the `media_paths` list.


## Response Bodies

For the sake of brevity, the JSON resources returned by the functions below
will not be individually listed. Instead, refer to these sample objects to see
what kind of data you can expect.

### Artist

    { "id" : 1,
      "name" : "The Artists",
      "url_name" : "the-artists",
      "tags" : [
        "genre:mathbluescore", "favorite"
    ] }


### Album

    { "id" : 1,
      "name" : "The Album",
      "url_name" : "the-album",
      "tags" : [
       "weird", "loud"
    ] }


### Track

    { "id" : 1,
      "name" : "The First Track",
      "url_name" : "the-first-track",
      "number" : 1,
      "filename" : "/path/to/media",
      "tags" : [
        "intro", "genre:classicalcore", "genre:mathbluescore"
    ] }


## URL Paths

The URL paths in the API calls defined below often refer to names of things
which are often not terribly URL-friendly. For this reason, when we discover new
content, we generate a "url_name" field, which gets used in URLs instead.


## API Calls

### POST /library/scan

Scans the configured media paths for content. Adds to the database information
about newly-discovered content. Removes from the database orphaned records
(files referenced in the database which no longer exist on disk).

You must be a 'contributor' or 'administrator' to do this.

#### Response Body

    { "orphans" : [ {
        "id" : 172,
        "name" : "Some Song",
        "url_name" : "some-song",
        "number" : 12,
        "filename" : "/path/to/library/Who Sang It/The Album Title/12 - Some Song.mp3"
      } ],
      "discoveries" : {
        "artists" : [ {
          "A New Singer",
          "Another New Guy"
        ],
        "albums" : [
          "A Brand New Album"
        ],
        "tracks" : [ {
          "filename" : "/path/to/library/A Band/A Disk of Songs/01 - A Track.mp3",
          "name" : "A Track",
          "number" : 1
        } ]
      }
    }


### GET /library/artists

Gets a list of all artists known to Beamie.


### GET /library/albums

Gets a list of all albums known to Beamie.


### GET /library/tracks

Gets a list of **all** tracks known to Beamie.


### GET /library/artists/<artist_name>

Gets info about the given artist.


### GET /library/artists/<artist_name>/tags

Gets a list of tags associated with the artist. Includes "user tags" for the 
authorized 'listener'.


### GET /library/artists/<artist_name>/albums

Retrieves a list of albums by the given artist.


### GET /library/artists/<artist_name>/albums/<album_name>

Gets info about the specified album.


### GET /library/artists/<artist_name>/albums/<album_name>/tags

Gets a list of tags associated with the album. Includes "user tags" for the 
authorized 'listener'.


### GET /library/artists/<artist_name>/albums/<album_name>/tracks

Gets a list of tracks on the given album.


### GET /library/artists/<artist_name>/albums/<album_name>/tracks/<track_title>

Gets info about the given track.


### GET /library/artists/<artist_name>/albums/<album_name>/tracks/<track_title>/tags

Gets a list of tags associated with the track. Includes "user tags" for the 
authorized 'listener'.


### GET /library/artists/<artist_id>

Gets data about the given artist.


### GET /library/tracks/<track_id>

Gets data about the given track.


### PUT /library/artists/<artist_id>

Updates data about the given artist. This data will be written to any media
files that will accept an artist tag.

#### Request Body

    { "name" : "New Artist Name" }


### PUT /library/albums/<album_id>

Updates data about the given album. This data will be written to any media
files that will accept an album tag.

#### Request Body

At least one of the following fields is required. User must be a 'contributor'.

    { "artist_id" : 2,
      "name" : "New Album Title" }


### PUT /library/tracks/<track_id>

Updates metadata about the given track. You may notice that the filename is not
a malleable value. Filenames must be discovered by the scanning process. See the
`POST` call to `/library/scan` above.

#### Request Body

At least one of the following fields is required. User must be a 'contributor'.

    { "album_id" : 1,
      "name" : "New Title",
      "number" : 2 }


### DELETE /library/artists/<artist_id>

Delets **all media files** associated with the given artist, across all albums.
This is destructive and irreversible.


### DELETE /library/albums/<album_id>

Deletes **all media files** associated with the given album. All tracks from
this album will be deleted from disk and removed from the library.


### DELETE /library/tracks/<track_id>

Deletes the specified track from the library, and also from disk. Please note
that this is a destructive function which will delete media from disk. Use with
caution. You must be a contributor or administrator to perform a track deletion.

